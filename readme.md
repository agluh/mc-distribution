# Система дистрибуции защищённых PDF файлов

## TD;LR
В своё время одна моя знакомая занималась распространением PDF с описанием всяких своих рукоделий.
Чтобы как-то защититься от "серого" оборота таких файлов, была придумана система криптозащиты. Со своей задачей она худо-бедно справлялась, поэтому решил оставить проект для истории.

Оглавление
=================
1. [Введение](#intro)
2. [Основные термины и определения](#terms)
3. [Принцип работы](#how_it_works)
4. [Создание защищённого PDF файла](#create_pdf)
5. [Генерация ключа продукта](#generate_licence)
6. [Просмотр защищённого PDF файла](#view_pdf)

<a name="intro"></a>
## Введение

Система дистрибуции предназначена для создания криптографически защищённых PDF файлов, для просмотра которых требуется получить ключ, 
привязанный к аппаратной конфигурации компьютера, где осуществляется просмотр.

<a name="terms"></a>
## Основные термины и определения

 * Защищённый PDF файл - исполняемый файл (*.exe), содержащий криптографически защищённый PDF файл и служебные данные для Администратора.
 * Клиент - лицо, для которого предназначен Защищённый PDF файл.
 * Администратор - лицо, создающее Защищённый PDF файл и распространяющее его.
 * Ключ продукта - набор символов, позволяющий Клиенту просмотреть Защищённый PDF файл.
 * Запрос ключа - набор символов, позволяющий Администратору сгенерировать для Клиента Ключ продукта.
 * Генерация ключа - процедура получения Ключа продукта из Запроса ключа.
 * Файл лицензии - файл *.lic, позволяющий Клиенту просмотреть Защищённый PDF файл без повторного запроса Ключа продукта у Администратора.

Система дистрибуции состоит из двух приложений:

 * mc_create.exe - служит для создание Защищённых PDF файлов.
 * mc_keygen.exe - служит для Генерации ключей для Клиентов.

<a name="how_it_works"></a>
## Принцип работы

 * Администратор с помощью программы mc_create.exe создаёт Защищённый PDF файл и отсылает его Клиенту.
 * Клиент при запуске исполняемого файла получает данные для Запроса ключа и отсылает их Администратору.
 * Администратор с помощью приложения mc_keygen.exe генерирует Ключ продукта на основе Запроса ключа и отправляет его Клиенту.
 * Клиент используя Ключ продукта получает доступ к содержимому Защищённого PDF файла.
 * В случае успешной активации, в папке с Защищённым PDF файлом создаётся одноимённый Файл лицензии и дальнейшее взаимодействие Клиента с Администратором прекращается.

ВАЖНО!
Клиент не должен получать доступа к приложению mc_keygen.exe. Приложение mc_create.exe не запрещается передавать Клиенту.

<a name="create_pdf"></a>
## Создание защищённого PDF файла

Приложение mc_create.exe требует следующие данные для создания Защищённого PDF файла:

 * Путь к исходному PDF файлу. Этот файл не должен быть защищён паролем и являться корректным PDF файлом.
 * Путь сохраняемому Защищённому PDF файлу. Пользователь должен иметь права записи по этому пути.
 * Текст ссылки. Это строка, для которой допускается HTML разметка. Строка выводится в диалоге запроса ключа в программе mc_view.exe
   Пример ссылки на сайт: ```<a href="www.example.com">My site</a>```
   Пример ссылки на почтовый адрес: ```<a href="mailto:mail@example.com">My mail</a>```
 * Текст водяного знака. Этот текст будет наложен на изображение при просмотре Клиентом Защищённого PDF файла.
 * Замечания - любая непустая строка символов, видимая лишь Администратором в приложении mc_keygen.exe при генерации Ключа продукта.

<a name="generate_licence"></a>
## Генерация ключа продукта

Приложение mc_keygen.exe требует указать лишь данные Запроса ключа для генерации на их основе Ключа продукта. Если данные Запроса ключа
окажутся неверными, Ключ продукта не будет сгенерирован. Если данные Запроса ключа являются корректными, помимо сгенерированного
Ключа продукта Администратор увидит данные, указанные при создании Защищённого PDF файла: текст ссылки, водяного знака и замечаний.
Кроме этого, выводятся некоторые отладочные данные, не используемые во взаимодействии с Клиентом.

<a name="view_pdf"></a>
## Просмотр защищённого PDF файла

Если в папке с Защищённым PDF файлом обнаружен одноимённый Файл лицензии и он корректен, Клиент сразу сможет просмотреть содержимое Защищённого PDF файла. 
Если Файл лицензии не найден или он некорректен, Клиенту будет показан диалог запроса Ключа продукта.